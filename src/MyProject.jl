module MyProject 

using SPICE
using Downloads: download
using LinearAlgebra
using NaNMath
using Statistics
using JLD2
using CSV
using DataFrames
using Dates
using Distributions

include("get_kernels.jl")
include("epoch_computations.jl")
include("coordinates.jl")
include("velocity.jl")
include("moon.jl")
include("time_loop.jl")

#set required body paramters as global variables 
#E,S,M radii (units:km)
earth_radius = bodvrd("EARTH", "RADII")[1]	
earth_radius_pole = bodvrd("EARTH", "RADII")[3]	
sun_radius = bodvrd("SUN","RADII")[1]
moon_radius = bodvrd("MOON", "RADII")[1] 

#timestamps taken from actual observations 
reiners_50 = ["2015-03-20T07:08:47.200000", "2015-03-20T07:10:35.800000", "2015-03-20T07:12:24.300000", "2015-03-20T07:14:12.900000", "2015-03-20T07:16:01.500000", "2015-03-20T07:17:50.300000", "2015-03-20T07:19:39.700000", "2015-03-20T07:21:28.500000", "2015-03-20T07:23:17.400000", "2015-03-20T07:25:06.500000", "2015-03-20T07:26:55.500000", "2015-03-20T07:28:43.800000", "2015-03-20T07:30:32.500000", "2015-03-20T07:32:20.700000", "2015-03-20T07:34:09.200000", "2015-03-20T07:35:59.500000", "2015-03-20T07:37:48.000000", "2015-03-20T07:39:36.100000", "2015-03-20T07:41:24.600000", "2015-03-20T07:43:12.800000", "2015-03-20T07:45:01.500000", "2015-03-20T07:46:50.100000", "2015-03-20T07:48:38.800000", "2015-03-20T07:50:27.100000", "2015-03-20T07:52:15.300000", "2015-03-20T07:54:03.900000", "2015-03-20T07:55:52.300000", "2015-03-20T07:57:40.700000", "2015-03-20T07:59:29.000000", "2015-03-20T08:01:17.200000", "2015-03-20T08:03:05.700000", "2015-03-20T08:04:54.000000", "2015-03-20T08:06:43.000000", "2015-03-20T08:08:31.400000", "2015-03-20T08:10:20.000000", "2015-03-20T08:12:08.500000", "2015-03-20T08:13:57.100000", "2015-03-20T08:15:45.300000", "2015-03-20T08:17:33.700000", "2015-03-20T08:19:22.100000", "2015-03-20T08:21:10.400000", "2015-03-20T08:22:59.400000", "2015-03-20T08:24:47.700000", "2015-03-20T08:26:36.100000", "2015-03-20T08:28:24.700000", "2015-03-20T08:30:13.000000", "2015-03-20T08:32:01.300000", "2015-03-20T08:33:49.500000", "2015-03-20T08:35:37.900000", "2015-03-20T08:37:26.300000", "2015-03-20T08:39:44.500000", "2015-03-20T08:41:33.000000", "2015-03-20T08:43:21.400000", "2015-03-20T08:45:09.900000", "2015-03-20T08:46:58.500000", "2015-03-20T08:48:46.800000", "2015-03-20T08:50:35.500000", "2015-03-20T08:52:24.000000", "2015-03-20T08:54:12.900000", "2015-03-20T08:56:01.500000", "2015-03-20T08:57:49.600000", "2015-03-20T08:59:37.900000", "2015-03-20T09:01:26.100000", "2015-03-20T09:03:14.800000", "2015-03-20T09:05:03.100000", "2015-03-20T09:06:51.700000", "2015-03-20T09:08:40.200000", "2015-03-20T09:10:28.700000", "2015-03-20T09:12:17.100000", "2015-03-20T09:14:05.500000", "2015-03-20T09:15:54.000000", "2015-03-20T09:17:43.100000", "2015-03-20T09:19:32.100000", "2015-03-20T09:21:20.900000", "2015-03-20T09:23:09.700000", "2015-03-20T09:24:58.500000", "2015-03-20T09:26:47.300000", "2015-03-20T09:28:35.900000", "2015-03-20T09:30:24.700000", "2015-03-20T09:32:13.100000", "2015-03-20T09:34:01.500000", "2015-03-20T09:35:49.900000", "2015-03-20T09:37:38.400000", "2015-03-20T09:39:27.400000", "2015-03-20T09:41:16.300000", "2015-03-20T09:43:05.000000", "2015-03-20T09:44:53.800000", "2015-03-20T09:46:42.200000", "2015-03-20T09:48:30.700000", "2015-03-20T09:50:19.700000", "2015-03-20T09:52:08.400000", "2015-03-20T09:53:57.500000", "2015-03-20T09:55:45.900000", "2015-03-20T09:57:34.900000", "2015-03-20T09:59:23.300000", "2015-03-20T10:01:11.800000", "2015-03-20T10:03:00.100000", "2015-03-20T10:04:48.600000", "2015-03-20T10:06:37.400000", "2015-03-20T10:08:26.200000", "2015-03-20T10:10:44.500000", "2015-03-20T10:12:33.900000", "2015-03-20T10:14:23.600000", "2015-03-20T10:16:12.600000", "2015-03-20T10:18:01.700000", "2015-03-20T10:19:50.900000", "2015-03-20T10:21:39.900000", "2015-03-20T10:23:28.900000", "2015-03-20T10:25:17.900000", "2015-03-20T10:27:07.000000", "2015-03-20T10:28:57.100000", "2015-03-20T10:30:46.100000", "2015-03-20T10:32:35.100000", "2015-03-20T10:34:24.000000", "2015-03-20T10:36:12.900000", "2015-03-20T10:38:02.000000", "2015-03-20T10:39:51.000000", "2015-03-20T10:41:39.900000", "2015-03-20T10:43:28.700000", "2015-03-20T10:45:17.600000", "2015-03-20T10:47:06.800000", "2015-03-20T10:48:55.800000", "2015-03-20T10:50:44.900000", "2015-03-20T10:52:33.600000", "2015-03-20T10:54:22.700000", "2015-03-20T10:56:11.900000", "2015-03-20T10:58:00.800000", "2015-03-20T10:59:49.700000", "2015-03-20T11:01:39.800000", "2015-03-20T11:03:28.600000", "2015-03-20T11:05:17.700000", "2015-03-20T11:07:06.800000", "2015-03-20T11:08:55.700000", "2015-03-20T11:10:44.600000", "2015-03-20T11:12:33.600000", "2015-03-20T11:14:23.100000", "2015-03-20T11:16:12.000000", "2015-03-20T11:18:00.900000", "2015-03-20T11:19:49.900000", "2015-03-20T11:21:38.700000", "2015-03-20T11:23:27.700000", "2015-03-20T11:25:16.700000", "2015-03-20T11:27:05.700000", "2015-03-20T11:28:54.300000", "2015-03-20T11:30:43.000000", "2015-03-20T11:32:31.700000", "2015-03-20T11:34:20.300000", "2015-03-20T11:36:09.000000", "2015-03-20T11:37:57.700000", "2015-03-20T11:39:46.900000", "2015-03-20T11:49:27.500000", "2015-03-20T11:51:16.600000", "2015-03-20T11:53:05.600000", "2015-03-20T11:54:54.200000", "2015-03-20T11:56:43.100000", "2015-03-20T11:58:31.800000", "2015-03-20T12:00:20.500000", "2015-03-20T12:02:09.100000", "2015-03-20T12:03:57.600000"]

reiners_timestamps = ["2015-03-20T7:07:57.2", "2015-03-20T7:09:45.8", "2015-03-20T7:11:34.3", "2015-03-20T7:13:22.9", "2015-03-20T7:15:11.5", "2015-03-20T7:17:00.3", "2015-03-20T7:18:49.7", "2015-03-20T7:20:38.5", "2015-03-20T7:22:27.4", "2015-03-20T7:24:16.5", "2015-03-20T7:26:05.5", "2015-03-20T7:27:53.8", "2015-03-20T7:29:42.5", "2015-03-20T7:31:30.7", "2015-03-20T7:33:19.2", "2015-03-20T7:35:09.5", "2015-03-20T7:36:58.0", "2015-03-20T7:38:46.1", "2015-03-20T7:40:34.6", "2015-03-20T7:42:22.8", "2015-03-20T7:44:11.5", "2015-03-20T7:46:00.1", "2015-03-20T7:47:48.8", "2015-03-20T7:49:37.1", "2015-03-20T7:51:25.3", "2015-03-20T7:53:13.9", "2015-03-20T7:55:02.3", "2015-03-20T7:56:50.7", "2015-03-20T7:58:39.0", "2015-03-20T8:00:27.2", "2015-03-20T8:02:15.7", "2015-03-20T8:04:04.0", "2015-03-20T8:05:53.0", "2015-03-20T8:07:41.4", "2015-03-20T8:09:30.0", "2015-03-20T8:11:18.5", "2015-03-20T8:13:07.1", "2015-03-20T8:14:55.3", "2015-03-20T8:16:43.7", "2015-03-20T8:18:32.1", "2015-03-20T8:20:20.4", "2015-03-20T8:22:09.4", "2015-03-20T8:23:57.7", "2015-03-20T8:25:46.1", "2015-03-20T8:27:34.7", "2015-03-20T8:29:23.0", "2015-03-20T8:31:11.3", "2015-03-20T8:32:59.5", "2015-03-20T8:34:47.9", "2015-03-20T8:36:36.3", "2015-03-20T8:38:54.5", "2015-03-20T8:40:43.0", "2015-03-20T8:42:31.4", "2015-03-20T8:44:19.9", "2015-03-20T8:46:08.5", "2015-03-20T8:47:56.8", "2015-03-20T8:49:45.5", "2015-03-20T8:51:34.0", "2015-03-20T8:53:22.9", "2015-03-20T8:55:11.5", "2015-03-20T8:56:59.6", "2015-03-20T8:58:47.9", "2015-03-20T9:00:36.1", "2015-03-20T9:02:24.8", "2015-03-20T9:04:13.1", "2015-03-20T9:06:01.7", "2015-03-20T9:07:50.2", "2015-03-20T9:09:38.7", "2015-03-20T9:11:27.1", "2015-03-20T9:13:15.5", "2015-03-20T9:15:04.0", "2015-03-20T9:16:53.1", "2015-03-20T9:18:42.1", "2015-03-20T9:20:30.9", "2015-03-20T9:22:19.7", "2015-03-20T9:24:08.5", "2015-03-20T9:25:57.3", "2015-03-20T9:27:45.9", "2015-03-20T9:29:34.7", "2015-03-20T9:31:23.1", "2015-03-20T9:33:11.5", "2015-03-20T9:34:59.9", "2015-03-20T9:36:48.4", "2015-03-20T9:38:37.4", "2015-03-20T9:40:26.3", "2015-03-20T9:42:15.0", "2015-03-20T9:44:03.8", "2015-03-20T9:45:52.2", "2015-03-20T9:47:40.7", "2015-03-20T9:49:29.7", "2015-03-20T9:51:18.4", "2015-03-20T9:53:07.5", "2015-03-20T9:54:55.9", "2015-03-20T9:56:44.9", "2015-03-20T9:58:33.3", "2015-03-20T10:00:21.8", "2015-03-20T10:02:10.1", "2015-03-20T10:03:58.6", "2015-03-20T10:05:47.4", "2015-03-20T10:07:36.2", "2015-03-20T10:09:54.5", "2015-03-20T10:11:43.9", "2015-03-20T10:13:33.6", "2015-03-20T10:15:22.6", "2015-03-20T10:17:11.7", "2015-03-20T10:19:00.9", "2015-03-20T10:20:49.9", "2015-03-20T10:22:38.9", "2015-03-20T10:24:27.9", "2015-03-20T10:26:17.0", "2015-03-20T10:28:07.1", "2015-03-20T10:29:56.1", "2015-03-20T10:31:45.1", "2015-03-20T10:33:34.0", "2015-03-20T10:35:22.9", "2015-03-20T10:37:12.0", "2015-03-20T10:39:01.0", "2015-03-20T10:40:49.9", "2015-03-20T10:42:38.7", "2015-03-20T10:44:27.6", "2015-03-20T10:46:16.8", "2015-03-20T10:48:05.8", "2015-03-20T10:49:54.9", "2015-03-20T10:51:43.6", "2015-03-20T10:53:32.7", "2015-03-20T10:55:21.9", "2015-03-20T10:57:10.8", "2015-03-20T10:58:59.7", "2015-03-20T11:00:49.8", "2015-03-20T11:02:38.6", "2015-03-20T11:04:27.7", "2015-03-20T11:06:16.8", "2015-03-20T11:08:05.7", "2015-03-20T11:09:54.6", "2015-03-20T11:11:43.6", "2015-03-20T11:13:33.1", "2015-03-20T11:15:22.0", "2015-03-20T11:17:10.9", "2015-03-20T11:18:59.9", "2015-03-20T11:20:48.7", "2015-03-20T11:22:37.7", "2015-03-20T11:24:26.7", "2015-03-20T11:26:15.7", "2015-03-20T11:28:04.3", "2015-03-20T11:29:53.0", "2015-03-20T11:31:41.7", "2015-03-20T11:33:30.3", "2015-03-20T11:35:19.0", "2015-03-20T11:37:07.7", "2015-03-20T11:38:56.9", "2015-03-20T11:48:37.5", "2015-03-20T11:50:26.6", "2015-03-20T11:52:15.6", "2015-03-20T11:54:04.2", "2015-03-20T11:55:53.1", "2015-03-20T11:57:41.8", "2015-03-20T11:59:30.5", "2015-03-20T12:01:19.1", "2015-03-20T12:03:07.6"]

neid_timestamps = ["2023-10-14T15:26:45.500000", "2023-10-14T15:28:07.500000", "2023-10-14T15:29:30.500000", "2023-10-14T15:30:53.500000", "2023-10-14T15:32:15.500000", "2023-10-14T15:33:38.500000", "2023-10-14T15:35:01.500000", "2023-10-14T15:36:23.500000", "2023-10-14T15:37:46.500000", "2023-10-14T15:39:09.500000", "2023-10-14T15:40:31.500000", "2023-10-14T15:41:54.500000", "2023-10-14T15:43:17.500000", "2023-10-14T15:44:39.500000", "2023-10-14T15:46:02.500000", "2023-10-14T15:47:25.500000", "2023-10-14T15:48:47.500000", "2023-10-14T15:50:10.500000", "2023-10-14T15:51:33.500000", "2023-10-14T15:52:56.500000", "2023-10-14T15:54:18.500000", "2023-10-14T15:55:41.500000", "2023-10-14T15:57:04.500000", "2023-10-14T15:58:26.500000", "2023-10-14T15:59:49.500000", "2023-10-14T16:01:12.500000", "2023-10-14T16:02:34.500000", "2023-10-14T16:03:57.500000", "2023-10-14T16:05:20.500000", "2023-10-14T16:06:42.500000", "2023-10-14T16:08:05.500000", "2023-10-14T16:09:28.500000", "2023-10-14T16:10:50.500000", "2023-10-14T16:12:13.500000", "2023-10-14T16:13:36.500000", "2023-10-14T16:14:58.500000", "2023-10-14T16:16:21.500000", "2023-10-14T16:17:44.500000", "2023-10-14T16:19:06.500000", "2023-10-14T16:20:29.500000", "2023-10-14T16:21:52.500000", "2023-10-14T16:23:15.500000", "2023-10-14T16:24:37.500000", "2023-10-14T16:26:00.500000", "2023-10-14T16:27:23.500000", "2023-10-14T16:28:45.500000", "2023-10-14T16:30:08.500000", "2023-10-14T16:31:31.500000", "2023-10-14T16:32:53.500000", "2023-10-14T16:34:16.500000", "2023-10-14T16:35:39.500000", "2023-10-14T16:37:01.500000", "2023-10-14T16:38:24.500000", "2023-10-14T16:39:47.500000", "2023-10-14T16:41:09.500000", "2023-10-14T16:42:32.500000", "2023-10-14T16:43:55.500000", "2023-10-14T16:45:17.500000", "2023-10-14T16:46:40.500000", "2023-10-14T16:48:03.500000", "2023-10-14T16:49:25.500000", "2023-10-14T16:50:48.500000", "2023-10-14T16:52:11.500000", "2023-10-14T16:53:33.500000", "2023-10-14T16:54:56.500000", "2023-10-14T16:56:19.500000", "2023-10-14T16:57:42.500000", "2023-10-14T16:59:04.500000", "2023-10-14T17:00:27.500000", "2023-10-14T17:01:50.500000", "2023-10-14T17:03:12.500000", "2023-10-14T17:04:35.500000", "2023-10-14T17:05:58.500000", "2023-10-14T17:07:20.500000", "2023-10-14T17:08:43.500000", "2023-10-14T17:10:06.500000", "2023-10-14T17:11:28.500000", "2023-10-14T17:12:51.500000", "2023-10-14T17:14:14.500000", "2023-10-14T17:15:36.500000", "2023-10-14T17:16:59.500000", "2023-10-14T17:18:22.500000", "2023-10-14T17:19:44.500000", "2023-10-14T17:21:07.500000", "2023-10-14T17:22:30.500000", "2023-10-14T17:23:52.500000", "2023-10-14T17:25:15.500000", "2023-10-14T17:26:38.500000", "2023-10-14T17:28:01.500000", "2023-10-14T17:29:23.500000", "2023-10-14T17:30:46.500000", "2023-10-14T17:32:09.500000", "2023-10-14T17:33:31.500000", "2023-10-14T17:34:54.500000", "2023-10-14T17:36:17.500000", "2023-10-14T17:37:39.500000", "2023-10-14T17:39:02.500000", "2023-10-14T17:40:25.500000", "2023-10-14T17:41:47.500000", "2023-10-14T17:43:10.500000", "2023-10-14T17:44:33.500000", "2023-10-14T17:45:55.500000", "2023-10-14T17:47:18.500000", "2023-10-14T17:48:41.500000", "2023-10-14T17:50:03.500000", "2023-10-14T17:51:26.500000", "2023-10-14T17:52:49.500000", "2023-10-14T17:54:11.500000", "2023-10-14T17:55:34.500000", "2023-10-14T17:56:57.500000", "2023-10-14T17:58:20.500000", "2023-10-14T17:59:42.500000", "2023-10-14T18:01:05.500000", "2023-10-14T18:02:28.500000", "2023-10-14T18:03:50.500000", "2023-10-14T18:05:13.500000", "2023-10-14T18:06:36.500000", "2023-10-14T18:07:58.500000", "2023-10-14T18:09:21.500000", "2023-10-14T18:10:44.500000", "2023-10-14T18:12:06.500000", "2023-10-14T18:13:29.500000", "2023-10-14T18:14:52.500000", "2023-10-14T18:16:14.500000", "2023-10-14T18:17:37.500000", "2023-10-14T18:19:00.500000", "2023-10-14T18:20:22.500000", "2023-10-14T18:21:45.500000", "2023-10-14T18:23:08.500000", "2023-10-14T18:24:30.500000", "2023-10-14T18:25:53.500000", "2023-10-14T18:27:16.500000", "2023-10-14T18:28:38.500000", "2023-10-14T18:30:01.500000", "2023-10-14T18:31:24.500000", "2023-10-14T18:32:47.500000", "2023-10-14T18:34:09.500000", "2023-10-14T18:35:32.500000", "2023-10-14T18:36:55.500000", "2023-10-14T18:38:17.500000", "2023-10-14T18:39:40.500000", "2023-10-14T18:41:03.500000", "2023-10-14T18:42:25.500000", "2023-10-14T18:43:48.500000", "2023-10-14T18:45:11.500000", "2023-10-14T18:46:33.500000", "2023-10-14T18:47:56.500000", "2023-10-14T18:49:19.500000", "2023-10-14T18:50:41.500000", "2023-10-14T18:52:04.500000", "2023-10-14T18:53:27.500000", "2023-10-14T18:54:49.500000", "2023-10-14T18:56:12.500000", "2023-10-14T18:57:35.500000", "2023-10-14T18:58:57.500000", "2023-10-14T19:00:20.500000", "2023-10-14T19:01:43.500000", "2023-10-14T19:03:06.500000"]

neid_find_airmass = ["2023-10-14T15:26:18.072", "2023-10-14T15:27:40.753", "2023-10-14T15:29:03.434", "2023-10-14T15:30:26.115", "2023-10-14T15:31:48.796", "2023-10-14T15:33:11.477", "2023-10-14T15:34:34.159", "2023-10-14T15:35:56.840", "2023-10-14T15:37:19.521", "2023-10-14T15:38:42.202", "2023-10-14T15:40:04.883", "2023-10-14T15:41:27.564", "2023-10-14T15:42:50.246", "2023-10-14T15:44:12.927", "2023-10-14T15:45:35.609", "2023-10-14T15:46:58.289", "2023-10-14T15:48:20.970", "2023-10-14T15:49:43.651", "2023-10-14T15:51:06.333", "2023-10-14T15:52:29.014", "2023-10-14T15:53:51.695", "2023-10-14T15:55:14.376", "2023-10-14T15:56:37.058", "2023-10-14T15:57:59.739", "2023-10-14T15:59:22.420", "2023-10-14T16:00:45.101", "2023-10-14T16:02:07.782", "2023-10-14T16:03:30.463", "2023-10-14T16:04:53.144", "2023-10-14T16:06:15.826", "2023-10-14T16:07:38.507", "2023-10-14T16:09:01.188", "2023-10-14T16:10:23.869", "2023-10-14T16:11:46.550", "2023-10-14T16:13:09.232", "2023-10-14T16:14:31.913", "2023-10-14T16:15:54.594", "2023-10-14T16:17:17.275", "2023-10-14T16:18:39.956", "2023-10-14T16:20:02.637", "2023-10-14T16:21:25.318", "2023-10-14T16:22:48.000", "2023-10-14T16:24:10.682", "2023-10-14T16:25:33.362", "2023-10-14T16:26:56.043", "2023-10-14T16:28:18.724", "2023-10-14T16:29:41.406", "2023-10-14T16:31:04.087", "2023-10-14T16:32:26.768", "2023-10-14T16:33:49.449", "2023-10-14T16:35:12.130", "2023-10-14T16:36:34.811", "2023-10-14T16:37:57.493", "2023-10-14T16:39:20.174", "2023-10-14T16:40:42.855", "2023-10-14T16:42:05.536", "2023-10-14T16:43:28.217", "2023-10-14T16:44:50.899", "2023-10-14T16:46:13.580", "2023-10-14T16:47:36.261", "2023-10-14T16:48:58.942", "2023-10-14T16:50:21.623", "2023-10-14T16:51:44.304", "2023-10-14T16:53:06.986", "2023-10-14T16:54:29.667", "2023-10-14T16:55:52.348", "2023-10-14T16:57:15.029", "2023-10-14T16:58:37.710", "2023-10-14T17:00:00.391", "2023-10-14T17:01:23.072", "2023-10-14T17:02:45.754", "2023-10-14T17:04:08.435", "2023-10-14T17:05:31.116", "2023-10-14T17:06:53.797", "2023-10-14T17:08:16.479", "2023-10-14T17:09:39.160", "2023-10-14T17:11:01.841", "2023-10-14T17:12:24.522", "2023-10-14T17:13:47.203", "2023-10-14T17:15:09.884", "2023-10-14T17:16:32.565", "2023-10-14T17:17:55.247", "2023-10-14T17:19:17.928", "2023-10-14T17:20:40.609", "2023-10-14T17:22:03.290", "2023-10-14T17:23:25.971", "2023-10-14T17:24:48.652", "2023-10-14T17:26:11.333", "2023-10-14T17:27:34.015", "2023-10-14T17:28:56.696", "2023-10-14T17:30:19.377", "2023-10-14T17:31:42.058", "2023-10-14T17:33:04.740", "2023-10-14T17:34:27.421", "2023-10-14T17:35:50.102", "2023-10-14T17:37:12.784", "2023-10-14T17:38:35.464", "2023-10-14T17:39:58.146", "2023-10-14T17:41:20.827", "2023-10-14T17:42:43.508", "2023-10-14T17:44:06.189", "2023-10-14T17:45:28.870", "2023-10-14T17:46:51.551", "2023-10-14T17:48:14.232", "2023-10-14T17:49:36.914", "2023-10-14T17:50:59.595", "2023-10-14T17:52:22.276", "2023-10-14T17:53:44.957", "2023-10-14T17:55:07.639", "2023-10-14T17:56:30.319", "2023-10-14T17:57:53.001", "2023-10-14T17:59:15.682", "2023-10-14T18:00:38.363", "2023-10-14T18:02:01.044", "2023-10-14T18:03:23.726", "2023-10-14T18:04:46.407", "2023-10-14T18:06:09.088", "2023-10-14T18:07:31.769", "2023-10-14T18:08:54.450", "2023-10-14T18:10:17.131", "2023-10-14T18:11:39.812", "2023-10-14T18:13:02.493", "2023-10-14T18:14:25.175", "2023-10-14T18:15:47.856", "2023-10-14T18:17:10.538", "2023-10-14T18:18:33.218", "2023-10-14T18:19:55.900", "2023-10-14T18:21:18.581", "2023-10-14T18:22:41.262", "2023-10-14T18:24:03.943", "2023-10-14T18:25:26.624", "2023-10-14T18:26:49.305", "2023-10-14T18:28:11.987", "2023-10-14T18:29:34.668", "2023-10-14T18:30:57.349", "2023-10-14T18:32:20.030", "2023-10-14T18:33:42.711", "2023-10-14T18:35:05.392", "2023-10-14T18:36:28.074", "2023-10-14T18:37:50.755", "2023-10-14T18:39:13.436", "2023-10-14T18:40:36.117", "2023-10-14T18:41:58.798", "2023-10-14T18:43:21.479", "2023-10-14T18:44:44.160", "2023-10-14T18:46:06.842", "2023-10-14T18:47:29.523", "2023-10-14T18:48:52.204", "2023-10-14T18:50:14.885", "2023-10-14T18:51:37.566", "2023-10-14T18:53:00.248", "2023-10-14T18:54:22.929", "2023-10-14T18:55:45.610", "2023-10-14T18:57:08.291", "2023-10-14T18:58:30.972", "2023-10-14T18:59:53.654", "2023-10-14T19:01:16.335", "2023-10-14T19:02:39.016"]

boulder_timestamps = ["2023-10-14T13:25:37", "2023-10-14T13:27:01", "2023-10-14T13:28:23", "2023-10-14T13:29:42", "2023-10-14T13:31:08", "2023-10-14T13:32:25", "2023-10-14T13:33:49", "2023-10-14T13:35:10", "2023-10-14T13:36:33", "2023-10-14T13:37:56", "2023-10-14T13:39:18", "2023-10-14T13:40:37", "2023-10-14T13:42:01", "2023-10-14T13:43:22", "2023-10-14T13:44:46", "2023-10-14T13:46:09", "2023-10-14T13:47:26", "2023-10-14T13:48:50", "2023-10-14T13:50:14", "2023-10-14T13:51:38", "2023-10-14T13:52:57", "2023-10-14T13:53:55", "2023-10-14T13:59:00", "2023-10-14T13:59:41", "2023-10-14T14:03:04", "2023-10-14T14:03:20", "2023-10-14T14:05:15", "2023-10-14T14:06:34", "2023-10-14T14:12:22", "2023-10-14T14:13:27", "2023-10-14T14:14:48", "2023-10-14T14:16:12", "2023-10-14T14:17:34", "2023-10-14T14:18:56", "2023-10-14T14:20:20", "2023-10-14T14:21:44", "2023-10-14T14:23:02", "2023-10-14T14:24:24", "2023-10-14T14:25:45", "2023-10-14T14:27:10", "2023-10-14T14:28:32", "2023-10-14T14:29:50", "2023-10-14T14:31:13", "2023-10-14T14:32:34", "2023-10-14T14:33:59", "2023-10-14T14:35:21", "2023-10-14T14:36:18", "2023-10-14T15:38:31", "2023-10-14T15:39:34", "2023-10-14T15:40:55", "2023-10-14T15:42:19", "2023-10-14T15:43:37", "2023-10-14T15:44:42", "2023-10-14T15:46:30", "2023-10-14T15:47:48", "2023-10-14T15:49:10", "2023-10-14T15:50:31", "2023-10-14T15:51:53", "2023-10-14T15:53:14", "2023-10-14T15:54:37", "2023-10-14T15:55:59", "2023-10-14T15:57:21", "2023-10-14T15:58:40", "2023-10-14T16:00:04", "2023-10-14T16:01:28", "2023-10-14T16:02:49", "2023-10-14T16:04:11", "2023-10-14T16:05:32", "2023-10-14T16:06:54", "2023-10-14T16:08:18", "2023-10-14T16:09:39", "2023-10-14T16:11:01", "2023-10-14T16:12:25", "2023-10-14T16:13:46", "2023-10-14T16:15:08", "2023-10-14T16:16:27", "2023-10-14T16:17:50", "2023-10-14T16:19:14", "2023-10-14T16:20:36", "2023-10-14T16:21:57", "2023-10-14T16:23:19", "2023-10-14T16:24:40", "2023-10-14T16:26:04", "2023-10-14T16:27:26", "2023-10-14T16:28:47", "2023-10-14T16:30:09", "2023-10-14T16:31:32", "2023-10-14T16:32:54", "2023-10-14T16:34:16", "2023-10-14T16:35:37", "2023-10-14T16:36:58", "2023-10-14T16:39:52", "2023-10-14T16:41:05", "2023-10-14T16:42:32", "2023-10-14T16:43:51", "2023-10-14T16:45:12", "2023-10-14T16:46:23", "2023-10-14T16:48:03", "2023-10-14T16:49:17", "2023-10-14T16:50:42", "2023-10-14T16:51:58", "2023-10-14T16:53:24", "2023-10-14T16:54:45", "2023-10-14T16:56:06", "2023-10-14T16:57:31", "2023-10-14T16:58:53", "2023-10-14T17:00:13", "2023-10-14T17:01:35", "2023-10-14T17:02:56", "2023-10-14T17:04:20", "2023-10-14T17:05:42", "2023-10-14T17:07:03", "2023-10-14T17:08:27", "2023-10-14T17:09:49", "2023-10-14T17:11:10", "2023-10-14T17:12:32", "2023-10-14T17:13:53", "2023-10-14T17:15:17", "2023-10-14T17:16:39", "2023-10-14T17:18:00", "2023-10-14T17:19:21", "2023-10-14T17:20:43", "2023-10-14T17:22:07", "2023-10-14T17:23:28", "2023-10-14T17:24:50", "2023-10-14T17:26:12", "2023-10-14T17:27:33", "2023-10-14T17:28:41", "2023-10-14T18:41:52", "2023-10-14T18:42:46", "2023-10-14T18:44:08", "2023-10-14T18:45:29", "2023-10-14T18:46:50", "2023-10-14T18:48:12", "2023-10-14T18:49:36", "2023-10-14T18:50:39", "2023-10-14T18:55:41", "2023-10-14T18:56:25", "2023-10-14T18:57:51", "2023-10-14T18:59:09", "2023-10-14T19:00:33", "2023-10-14T19:01:54", "2023-10-14T19:03:13", "2023-10-14T19:04:37", "2023-10-14T20:37:30", "2023-10-14T23:07:01", "2023-10-14T23:07:58", "2023-10-14T23:09:18"]

expres_timestamps = ["2023-10-14T14:10:59", "2023-10-14T14:14:06", "2023-10-14T14:17:04", "2023-10-14T14:19:54", "2023-10-14T14:23:59", "2023-10-14T14:26:38", "2023-10-14T14:29:11", "2023-10-14T14:31:41", "2023-10-14T14:34:09", "2023-10-14T14:36:33", "2023-10-14T14:38:56", "2023-10-14T14:41:16", "2023-10-14T14:43:33", "2023-10-14T14:45:49", "2023-10-14T14:49:17", "2023-10-14T14:51:29", "2023-10-14T14:53:39", "2023-10-14T14:55:48", "2023-10-14T14:57:56", "2023-10-14T15:00:03", "2023-10-14T15:02:09", "2023-10-14T15:04:15", "2023-10-14T15:06:19", "2023-10-14T15:08:22", "2023-10-14T15:11:40", "2023-10-14T15:13:41", "2023-10-14T15:15:43", "2023-10-14T15:17:45", "2023-10-14T15:19:45", "2023-10-14T15:21:48", "2023-10-14T15:23:51", "2023-10-14T15:25:56", "2023-10-14T15:28:00", "2023-10-14T15:30:06", "2023-10-14T15:32:14", "2023-10-14T15:34:25", "2023-10-14T15:36:37", "2023-10-14T15:38:53", "2023-10-14T15:41:09", "2023-10-14T15:43:29", "2023-10-14T15:45:53", "2023-10-14T15:48:23", "2023-10-14T15:51:00", "2023-10-14T15:53:43", "2023-10-14T15:57:47", "2023-10-14T16:00:54", "2023-10-14T16:04:16", "2023-10-14T16:07:56", "2023-10-14T16:11:48", "2023-10-14T16:15:39", "2023-10-14T16:19:29", "2023-10-14T16:23:20", "2023-10-14T16:27:13", "2023-10-14T16:31:06", "2023-10-14T16:35:00", "2023-10-14T16:38:52", "2023-10-14T16:42:43", "2023-10-14T16:46:34", "2023-10-14T16:50:25", "2023-10-14T16:54:17", "2023-10-14T16:57:59", "2023-10-14T17:01:24", "2023-10-14T17:04:31", "2023-10-14T17:07:27", "2023-10-14T17:10:11", "2023-10-14T17:12:47", "2023-10-14T17:15:16", "2023-10-14T17:17:38", "2023-10-14T17:19:55", "2023-10-14T17:22:07", "2023-10-14T17:24:15", "2023-10-14T17:26:20", "2023-10-14T17:28:19", "2023-10-14T17:30:16", "2023-10-14T17:34:02", "2023-10-14T17:37:09", "2023-10-14T17:40:07", "2023-10-14T17:43:00", "2023-10-14T17:45:50", "2023-10-14T17:48:35", "2023-10-14T17:51:20", "2023-10-14T17:53:58", "2023-10-14T17:56:37", "2023-10-14T17:59:18", "2023-10-14T18:01:52", "2023-10-14T18:05:29", "2023-10-14T18:08:02", "2023-10-14T18:10:35", "2023-10-14T18:13:16", "2023-10-14T18:15:46", "2023-10-14T18:18:17", "2023-10-14T18:20:47", "2023-10-14T18:23:22", "2023-10-14T18:25:54", "2023-10-14T18:28:25", "2023-10-14T18:30:52", "2023-10-14T18:33:32", "2023-10-14T18:37:00", "2023-10-14T18:39:30", "2023-10-14T18:41:55", "2023-10-14T18:44:21", "2023-10-14T18:46:46", "2023-10-14T18:49:15", "2023-10-14T18:51:40", "2023-10-14T18:54:04", "2023-10-14T18:56:29", "2023-10-14T18:58:54", "2023-10-14T19:01:19", "2023-10-14T19:03:43", "2023-10-14T19:06:07", "2023-10-14T19:09:34", "2023-10-14T19:11:58", "2023-10-14T19:14:20", "2023-10-14T19:16:42", "2023-10-14T19:19:05", "2023-10-14T19:21:36", "2023-10-14T19:23:58", "2023-10-14T19:26:24", "2023-10-14T19:28:46", "2023-10-14T19:31:10", "2023-10-14T19:33:32", "2023-10-14T19:35:57", "2023-10-14T19:38:23", "2023-10-14T19:41:47", "2023-10-14T19:44:09", "2023-10-14T19:46:29", "2023-10-14T19:48:51", "2023-10-14T19:51:13", "2023-10-14T19:53:36", "2023-10-14T19:56:04", "2023-10-14T19:58:25", "2023-10-14T20:00:45", "2023-10-14T20:03:06", "2023-10-14T20:05:34", "2023-10-14T20:07:54", "2023-10-14T20:10:15", "2023-10-14T20:13:40", "2023-10-14T20:16:00", "2023-10-14T20:18:23", "2023-10-14T20:20:44", "2023-10-14T20:23:05", "2023-10-14T20:25:26", "2023-10-14T20:27:56", "2023-10-14T20:30:26", "2023-10-14T20:32:50", "2023-10-14T20:35:11", "2023-10-14T20:37:33", "2023-10-14T20:39:59", "2023-10-14T20:42:25", "2023-10-14T20:45:52", "2023-10-14T20:48:12", "2023-10-14T20:50:34", "2023-10-14T20:52:57", "2023-10-14T20:55:23", "2023-10-14T20:57:50", "2023-10-14T21:00:11", "2023-10-14T21:02:35", "2023-10-14T21:04:58", "2023-10-14T21:07:19", "2023-10-14T21:09:42", "2023-10-14T21:12:04", "2023-10-14T21:14:26", "2023-10-14T21:17:55", "2023-10-14T21:20:20", "2023-10-14T21:22:44", "2023-10-14T21:25:08", "2023-10-14T21:27:31", "2023-10-14T21:30:00", "2023-10-14T21:32:23", "2023-10-14T21:34:51", "2023-10-14T21:37:15", "2023-10-14T21:39:40", "2023-10-14T21:42:06", "2023-10-14T21:44:31", "2023-10-14T21:46:57", "2023-10-14T21:50:24", "2023-10-14T21:52:51", "2023-10-14T21:55:17", "2023-10-14T21:57:44", "2023-10-14T22:00:13", "2023-10-14T22:02:42", "2023-10-14T22:05:12", "2023-10-14T22:07:41", "2023-10-14T22:10:10", "2023-10-14T22:12:40", "2023-10-14T22:15:11", "2023-10-14T22:17:43", "2023-10-14T22:20:15", "2023-10-14T22:23:59", "2023-10-14T22:26:36", "2023-10-14T22:29:19", "2023-10-14T22:31:56", "2023-10-14T22:34:31", "2023-10-14T22:37:06", "2023-10-14T22:39:42", "2023-10-14T22:42:18", "2023-10-14T22:44:54", "2023-10-14T22:47:33", "2023-10-14T22:50:16", "2023-10-14T22:52:56", "2023-10-14T22:56:41", "2023-10-14T22:59:11"]

airmass = [3.79, 3.73, 3.67, 3.61, 3.56, 3.50, 3.45, 3.40, 3.35, 3.30, 3.26, 3.21, 3.17, 3.13, 3.09, 3.05, 3.01, 2.98, 2.94, 2.91, 2.87, 2.84, 2.81, 2.78, 2.75, 2.72, 2.69, 2.66, 2.63, 2.61, 2.58, 2.56, 2.53, 2.51, 2.49, 2.46, 2.44, 2.42, 2.40, 2.38, 2.36, 2.34, 2.32, 2.30, 2.28, 2.26, 2.25, 2.23, 2.21, 2.20, 2.18, 2.16, 2.15, 2.13, 2.12, 2.10, 2.09, 2.08, 2.06, 2.05, 2.04, 2.03, 2.01, 2.00, 1.99, 1.98, 1.97, 1.96, 1.95, 1.94, 1.93, 1.92, 1.91, 1.90, 1.89, 1.88, 1.87, 1.86, 1.85, 1.85, 1.84, 1.83, 1.82, 1.81, 1.81, 1.80, 1.79, 1.79, 1.78, 1.77, 1.77, 1.76, 1.75, 1.75, 1.74, 1.74, 1.73, 1.73, 1.72, 1.72, 1.71, 1.71, 1.70, 1.70, 1.69, 1.69, 1.68, 1.68, 1.68, 1.67, 1.67, 1.66, 1.66, 1.66, 1.65, 1.65, 1.65, 1.65, 1.64, 1.64, 1.64, 1.64, 1.63, 1.63, 1.63, 1.63, 1.63, 1.62, 1.62, 1.62, 1.62, 1.62, 1.62, 1.62, 1.62, 1.62, 1.61, 1.61, 1.61, 1.61, 1.61, 1.61, 1.61, 1.61, 1.61, 1.61, 1.61, 1.61, 1.61, 1.61, 1.62, 1.62, 1.62, 1.62, 1.62, 1.62, 1.63, 1.63, 1.63]

ext_coef = [0.4, 0.3981012658227848, 0.3962025316455696, 0.3943037974683545, 0.3924050632911393, 0.3905063291139241, 0.3886075949367089, 0.3867088607594937, 0.3848101265822785, 0.38291139240506333, 0.38101265822784813, 0.37911392405063293, 0.37721518987341773, 0.37531645569620253, 0.37341772151898733, 0.3715189873417722, 0.369620253164557, 0.3677215189873418, 0.3658227848101266, 0.3639240506329114, 0.36202531645569624, 0.36012658227848104, 0.35822784810126584, 0.35632911392405064, 0.35443037974683544, 0.35253164556962024, 0.3506329113924051, 0.3487341772151899, 0.3468354430379747, 0.3449367088607595, 0.3430379746835443, 0.34113924050632916, 0.33924050632911396, 0.33734177215189876, 0.33544303797468356, 0.33354430379746836, 0.33164556962025316, 0.32974683544303796, 0.3278481012658228, 0.3259493670886076, 0.3240506329113924, 0.3221518987341772, 0.32025316455696207, 0.31835443037974687, 0.31645569620253167, 0.31455696202531647, 0.31265822784810127, 0.31075949367088607, 0.30886075949367087, 0.30696202531645567, 0.3050632911392405, 0.3031645569620253, 0.3012658227848101, 0.2993670886075949, 0.2974683544303798, 0.2955696202531646, 0.2936708860759494, 0.2917721518987342, 0.289873417721519, 0.2879746835443038, 0.2860759493670886, 0.28417721518987343, 0.28227848101265823, 0.28037974683544303, 0.27848101265822783, 0.2765822784810127, 0.2746835443037975, 0.2727848101265823, 0.2708860759493671, 0.2689873417721519, 0.2670886075949367, 0.2651898734177215, 0.2632911392405063, 0.26139240506329114, 0.25949367088607594, 0.25759493670886074, 0.2556962025316456, 0.2537974683544304, 0.2518987341772152, 0.25, 0.2481012658227848, 0.2462025316455696, 0.24430379746835443, 0.24240506329113923, 0.24050632911392406, 0.23860759493670886, 0.23670886075949366, 0.23481012658227848, 0.23291139240506328, 0.23101265822784808, 0.2291139240506329, 0.2272151898734177, 0.2253164556962025, 0.22341772151898734, 0.22151898734177214, 0.21962025316455694, 0.21772151898734177, 0.21582278481012657, 0.21392405063291137, 0.2120253164556962, 0.210126582278481, 0.20822784810126582, 0.20632911392405062, 0.20443037974683542, 0.20253164556962025, 0.20063291139240505, 0.19873417721518985, 0.19683544303797468, 0.19493670886075948, 0.19303797468354428, 0.1911392405063291, 0.1892405063291139, 0.1873417721518987, 0.18544303797468353, 0.18354430379746833, 0.18164556962025313, 0.17974683544303796, 0.17784810126582276, 0.17594936708860756, 0.1740506329113924, 0.1721518987341772, 0.17025316455696202, 0.16835443037974682, 0.16645569620253162, 0.16455696202531644, 0.16265822784810124, 0.16075949367088604, 0.15886075949367087, 0.15696202531645567, 0.15506329113924047, 0.1531645569620253, 0.1512658227848101, 0.1493670886075949, 0.1474683544303797, 0.14556962025316456, 0.14367088607594936, 0.14177215189873416, 0.13987341772151896, 0.13797468354430376, 0.13607594936708856, 0.1341772151898734, 0.1322784810126582, 0.130379746835443, 0.1284810126582278, 0.1265822784810126, 0.12468354430379741, 0.12278481012658227, 0.12088607594936707, 0.11898734177215187, 0.11708860759493667, 0.11518987341772147, 0.11329113924050632, 0.11139240506329112, 0.10949367088607592, 0.10759493670886072, 0.10569620253164552, 0.10379746835443032, 0.10189873417721518, 0.1]

#linear interpolation for convective blueshift from reiners 2016
AA = AbstractArray
function linear_interp(xs::AA{T,1}, ys::AA{T,1}; bc::T=NaN) where T<:Float64
    function f(x)
        if (((x < first(xs)) | (x > last(xs))) & !isnan(bc))
            return bc
        elseif x <= first(xs)
            return first(ys)
        elseif x >= last(xs)
            return last(ys)
        else

            i = searchsortedfirst(xs, x) - 1
            i0 = clamp(i, firstindex(ys), lastindex(ys))
            i1 = clamp(i+1, firstindex(ys), lastindex(ys))
            return (ys[i0] * (xs[i1] - x) + ys[i1] * (x - xs[i0])) / (xs[i1] - xs[i0])
        end
    end
    return f
end
file = DataFrame(CSV.File("src/convective_blueshift.csv"))
blueshift_values = reverse((file." blueshift"))
mu_values = reverse(file."mu")
convective_blueshift_interpol = linear_interp(mu_values, blueshift_values)
end 

# lambda_nm = [303.327, 310.843, 320.468, 329.897, 349.947, 365.875, 374.086, 390.915, 401.970, 416.319, 427.930, 443.885, 445.125, 457.345, 477.427, 492.905, 519.930, 541.76, 559.95, 579.88, 610.975, 640.97, 669.4, 700.875, 748.71, 811.76, 869.6, 948.85, 1046.6, 1098.95]
# a0 = [0.08011, 0.08160, 0.08833, 0.09188, 0.11012, 0.12828, 0.12579, 0.12995, 0.12323, 0.12814, 0.14249, 0.16220, 0.15248, 0.16604, 0.19571, 0.20924, 0.23695, 0.26073, 0.26892, 0.28392, 0.30854, 0.33644, 0.34685, 0.37885, 0.40627, 0.42977, 0.45396, 0.47855, 0.49870, 0.51149]
# a1 = [0.70695, 0.71609, 0.77285, 0.92459, 1.02168, 1.04969, 0.85402, 0.91836, 1.08648, 1.19947, 1.28796, 1.24893, 1.38517, 1.38544, 1.30551, 1.30798, 1.29927, 1.27428, 1.34319, 1.36896, 1.3662, 1.30590, 1.37539, 1.25553, 1.22842, 1.25182, 1.25101, 1.19813, 1.21429, 1.19354]
# a2 = [0.4991, 0.69685, 0.65382, 0.19604, -0.10924, 0.17482, 0.54601, -0.07566, -0.43974, -0.84407, -1.19564, -0.92165, -1.49615, -1.52275, -1.25845, -1.20411, -1.28034, -1.30352, -1.58427, -1.75998, -1.83572, -1.79238, -2.04425, -1.70908, -1.67877, -1.85164, -2.02958, -1.86296, -2.06976, -2.00174]
# a3 = [-0.31080, -0.87703, -1.04647, -0.39546, -0.00055, -1.13371, -1.15048, 0.19149, 0.45912, 1.07201, 1.68603, 0.89978, 1.99886, 2.00232, 1.50626, 1.21505, 1.37760, 1.47085, 1.91271, 2.22154, 2.33221, 2.4504, 2.70493, 2.19647, 2.05535, 2.31949, 2.7541, 2.36939, 2.80703, 2.66936]
# a4 = [-0.02177, 0.47008, 0.72921, 0.23599, -0.08688, 1.23882, 0.88928, -0.28712, -0.32759, -0.79537, -1.36658, -0.50148, -1.48155, -1.45969, -1.05472, -0.67196, -0.85054, -0.96618, -1.3135, -1.56074, -1.63082, -1.89979, -1.9429, -1.59554, -1.39972, -1.59101, -2.02287, -1.64367, -2.05247, -1.94981]
# a5 = [0.04642, -0.0876, -0.19775, -0.05303, 0.06487, -0.4599, -0.26462, 0.12298, 0.0985, 0.23982, 0.44572, 0.1122, 0.44119, 0.42864, 0.30570, 0.14381, 0.21706, 0.26384, 0.37295, 0.4463, 0.45959, 0.59943, 0.55999, 0.47378, 0.38845, 0.44155, 0.59338, 0.46056, 0.60221, 0.57715]
